# 98_Kafka

## 기본정보

- 목적 : 스트림 처리를 위해 활용한다. Kafka의 구조, 운영에 대해 알자

  consumer group / broker / topic / partition / kafka는 왜 빠른가 / produce, consume 속도에 따른 구성

- 기간 : 2021/11/05 ~ 2021/11/08

- Ref :
  - 책 <실전 아파치 카프카>
  - 유튜브 [[Kafka의 등장배경](https://www.youtube.com/watch?v=waw0XXNX-uQ)]





### 등장배경

- 상품 데이터는 수시로 업데이트된다. 할인 행사가 있다거나, 상품이 품절된다거나.. 과거에 아키텍쳐가 복잡했을 때에는 데이터가 업데이트 되었음을 알려주는 게 복잡했다. 그래서 kafka라는 툴을 사용해서 데이터를 변경 즉시, 일괄적으로 관리하는 것이다. [[영상\]](https://www.youtube.com/watch?v=waw0XXNX-uQ)
- DB, hadoop, spark 같은 툴로는 스트림 데이터를 처리할 수 없을까? DB는 Exactly once `전달 보증 수준`을 중시하는데, 이걸 구현하려면 여러 통신이 추가된다. Kafka는 전달 보증 수준을 낮추는 대신, 처리량을 높이는 선택지를 택했다. 하둡과 스파크는 데이터를 축적해 `일괄` 처리하는 데 초점이 맞춰져 있었기 때문에, 실시간으로 처리하는 데에 적합하지 않았다.

![01](./asset/kafka01.png)

![02](./asset/kafka02.png)





## Kafka의 구조

![03](./asset/kafka03.jpeg)

- Kafka의 목표는 다음과 같다. 1️⃣높은 처리량으로 실시간 처리한다, 2️⃣임의의 타이밍에서 데이터를 읽는다, 3️⃣다양한 제품과 시스템에 쉽게 연동한다, 4️⃣메시지를 잃지 않는다.

- Kafka는 데이터를 실시간으로 처리하는 게 핵심이다. 이를 구현하기 위해 Kafka는 큐잉 메시징 모델, 펍섭 메시징 모델을 응용했다. 먼저 `펍 ↔ 브로커 ↔ 섭`로 구조를 분해했다. 펍은 메시지가 어느 섭에 전달되는지 모르고, 섭도 메시지가 어느 펍에서 오는지 모른다. 다만 각자의 할 일을 할 뿐. 이런 역할 분리로 각자의 부담을 줄이고, 처리량을 늘렸다.

- 또한 메시지를 잃지 않아야 했기에 At least once 전달 보증 기능을 제공한다. 최근에는 Exactly once 수준도 제공한다.

  

- Consumer Group
- Partition
- Kafka 는 왜 빠른가
- produce, consume 속도에 따른 구성