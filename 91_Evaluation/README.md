# [91_Evaluation](./91_Evaluation)

#### 기본 정보

- 목적 : 애플리케이션을 평가하는 기준과 좌충우돌
- 기간 : 2021/12
- Ref :

## 테스트

- 성능 테스트 : 속도, 확장성, 안정성 측면

- 부하 테스트 : 앱의 최대 로드, 디비의 최대 데이터 양, 네트워크 통신량

- 스트레스 테스트 : 서버가 고장날 경우에 어떻게 복구할 것인가

  

## API

- by wrk
- API 는 스피드가 중요하고, throughput 과 latency 를 기준으로 평가할 수 있다.

##### 평가 지표

- throughput  = 초당 얼마나 많은 데이터를 처리하느냐
- Transfer / sec = 초당 전송된 데이터 양
  다만 데이터 사이즈가 큰 객체를 전송할 경우 왜곡될 가능성이 있다. (데이터 양이 많다고 스피드가 빠른 건 아니라는 뜻)
  요즘의 네트워크 망은 초당 100MB를 보낸다. 따라서 그 이상의 점수는 무의미하다.
- Request / sec = 초당 처리하는 요청의 개수
  많을수록 좋고, 최소한 500은 넘는 것을 목표로 했다.
- Latency Distribution
  1 s = 1000 ms 이다.
  2 s 이상 넘어가는 않는 것을 목표로 했다.



## Memory

- by visual VM
- Memory 가 충분한지, 메모리릭이 발생하지 않는지 점검해야 한다.

##### Garbage Collection

- 메모리 상에 있지만 쓰이지 않는 Garbage들.. JVM이 자동으로 해주기는 하지만 완벽하지는 않다.
- visual VM 을 지켜보면서 메모리릭을 감지했고 원인을 찾아보았다. 처음엔 함수 내부에서 선언한 변수를 지우지 않은 것이 원인일 거라 생각했지만, 힙메모리에 선언하고도 지우지 않은 변수들이 있었다.
  - 원시형 변수는 stack memory 에, 참조형 변수는 heap memory 에 저장된다.
    함수가 종료될 때마다 stack은 비워진다. 그러므로 이 변수들은 메모리릭에 영향을 주지 않는다.
  - 반면에 heap 은 GC + 개발자가 지워줘야 한다. heap에서 이름이 있는 객체는 지웠지만, 임시로 생성한 객체를 지우지 않았다. 여기서 메모리 누수가 발생했다.

##### Blue Green update

- GC + 개발자는 완벽하지 않고, 언젠가는 메모리 용량이 초과한다. 결국에는 서버를 껐다가 다시 켜는 작업이 필요하다.

- 서버를 팟 꺼버리면, 진행 중이던 연산에 문제가 생길 수 있다. 그래서 서버의 사용자 트래픽이 모두 없어졌을 때 종료해야 한다. 이걸 블루 그린 업데이트라고 한다.

- 서버를 껐다 킬 때에 Hadoop 환경과 연결한다든지 여러 가지 작업이 수반된다. 이에 대한 내용을 shell script 로 작성하고, crontab | jenkins 의 도움으로 자동화할 수 있다.

  



